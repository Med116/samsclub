<html>
	<head>
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
		<link type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
	</head>
	<body style="margin-left:100px;padding-left:100px;">
		<img src="http://monroearts.com/wp-content/uploads/2015/07/tickets.png" />
		<h1> Tickets Available: <span class="tix_count">...</span> </h1>
		
		<p class="input_data email"> Enter your email to hold and reserve tickets: <input type="text"/></p>
		
		<p class="input_data action_hold"> Hold Tickets (enter in amount you would like to hold): <input type="text"/>
			<button>Hold Tickets</button>
		</p>
		
		<p class="input_data action_reserve"> Reserve Tickets <input type="text"/>
			<button>Reserve Tickets</button>
		</p>
		
		<div id="hold_confirmation">
		
		</div>
		
		<div id="seats_chart">
		
		</div>
		
		<script>
			
			function getAvailableSeatsCount(){
				
				jQuery.post("/seats/available/", function(json){
					jQuery(".tix_count").text(json.availableNum);
				});
				
			}
			
			function getEmail(){
				
				var email = jQuery(".email input").val();
				if(email !== undefined){
					return email;
				}else{
					alert("You must enter in an email address");
					return false;
				}
			}
			
			function reserveSeats(){
				var holdId = jQuery(".action_reserve input").val();
				var data = {seatHoldId: holdId, email:getEmail};
				jQuery.post("/seats/reserve/", data, function(json){
					console.log(json);
					jQuery(".action_reserve").text("SUCCESS: YOUR CODE: " + json.code + " SEATS : " + json.seats.length  );
				});	
			
			}
			
			
			function holdSeats(){
				console.log("IN HOLD SEATS");
				var email = getEmail();
				console.log("EMAIL: " , email);
				
				if(email){
					
					var holdCount = jQuery(".action_hold input").val();
					
					if(holdCount !== undefined){
						
						jQuery.post("/seats/find-and-hold/",{email: email,numSeats: holdCount },  function(json){
							console.log("JSON: " , json);
							var holdId = json['holdId'];
							if(parseInt(holdId)){
								var list = jQuery("<ol></ol>");
								json.seatsHeld.map(function(seat){
									list.append(jQuery("<li>" + seat.seatIndex + "</li>"))
								});
								jQuery("#hold_confirmation").append(list);
								jQuery(".action_reserve input").val(json.holdId);
								
							}
							getAvailableSeatsCount();
							
						});
						
					}else{
						alert("Please enter # of tickets you would like to hold");
					}
							
				}
			}
			
			jQuery(document).ready(function(){
				getAvailableSeatsCount();
				jQuery(document).on("click", ".action_hold button", holdSeats);
				jQuery(document).on("click", ".action_reserve button", reserveSeats);
				
			});
			
		</script>
		
		
	</body>
</html>